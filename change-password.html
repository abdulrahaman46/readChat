<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Change Password</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="center-card">
        <h3>Change default password</h3>
        <input id="newpw" type="password" placeholder="New password" />
        <input id="newpw2" type="password" placeholder="Repeat password" />
        <button id="btnChange" class="btn-primary">Change password</button>
        <div id="msg" class="muted"></div>
    </div>

    <script>
        const btn = document.getElementById('btnChange');
        const msg = document.getElementById('msg');

        btn.addEventListener('click', async () => {
            const p1 = document.getElementById('newpw').value.trim();
            const p2 = document.getElementById('newpw2').value.trim();
            const adminId = localStorage.getItem('adminId');

            if (!p1 || p1.length < 6) { msg.textContent = 'Use at least 6 characters'; return; }
            if (p1 !== p2) { msg.textContent = 'Passwords do not match'; return; }
            if (!adminId) { msg.textContent = 'Admin session not found, please log in again'; return; }

            try {
                const res = await fetch('http://localhost:3000/change-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ adminId, newPassword: p1 })
                });

                const data = await res.json();

                if (res.ok && data.success) {
                    msg.textContent = 'Password changed successfully! Redirecting...';
                    setTimeout(() => window.location = 'index.html', 1500);
                } else {
                    msg.textContent = data.message || 'Failed to change password';
                }
            } catch (err) {
                console.error(err);
                msg.textContent = 'Server connection error';
            }
        });
    </script>
</body>
</html>
